<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Прямая трансляция - FS Aesthet</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --tg-bg-primary: #f0f2f5;
            --tg-text-primary: #000000;
            --tg-text-secondary: #8e8e93;
            --tg-accent-blue: #007AFF;
            --tg-accent-blue-hover: #005EC4;
            --tg-accent-red: #FF3B30;
            --tg-accent-red-hover: #D70015;
            --tg-header-bg: #ffffff;
            --tg-header-shadow: 0 1px 0 rgba(0, 0, 0, 0.08);
            --tg-card-bg: linear-gradient(135deg, #ffffff 0%, #f7f7f9 100%);
            --tg-card-border: #dcdcdc;
            --tg-card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --tg-player-bg: #000000;
            --tg-controls-bg: rgba(0, 0, 0, 0.8);
            --tg-progress-bg: rgba(255, 255, 255, 0.3);
            --tg-progress-filled: #007AFF;
            --transition-speed: 0.3s ease;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--tg-bg-primary);
            color: var(--tg-text-primary);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--tg-header-bg);
            padding: 12px 20px;
            box-shadow: var(--tg-header-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Roboto Condensed', sans-serif;
            font-weight: 700;
            font-size: 1.5em;
            color: var(--tg-accent-blue);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .main-content {
            flex: 1;
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .page-title {
            font-family: 'Roboto Condensed', sans-serif;
            font-size: 2.5em;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .live-badge {
            background: var(--tg-accent-red);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.4em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 59, 48, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0); }
        }

        .page-subtitle {
            text-align: center;
            color: var(--tg-text-secondary);
            margin-bottom: 30px;
        }

        .player-container {
            background: var(--tg-card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid var(--tg-card-border);
            box-shadow: var(--tg-card-shadow);
        }

        .player-wrapper {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            border-radius: 12px;
            overflow: hidden;
            background: var(--tg-player-bg);
            aspect-ratio: 16/9;
            cursor: pointer;
        }

        #videoPlayer {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            display: block;
        }

        /* Кастомные контролы */
        .custom-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, var(--tg-controls-bg));
            padding: 20px 15px 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            opacity: 0;
            transition: opacity var(--transition-speed);
            z-index: 20;
        }

        .player-wrapper:hover .custom-controls,
        .player-wrapper.controls-visible .custom-controls {
            opacity: 1;
        }

        /* Всегда показывать контролы на мобильных */
        @media (max-width: 768px) {
            .custom-controls {
                opacity: 1 !important;
                background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
            }
            
            .player-wrapper {
                cursor: default;
            }
        }

        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all var(--transition-speed);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .progress-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            flex: 1;
            height: 4px;
            background: var(--tg-progress-bg);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
            transition: height 0.2s ease;
        }

        .progress-bar:hover {
            height: 6px;
        }

        .progress-filled {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: var(--tg-progress-filled);
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s linear;
        }

        .progress-handle {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .progress-bar:hover .progress-handle {
            opacity: 1;
        }

        .time-display {
            color: white;
            font-size: 0.9em;
            font-weight: 500;
            min-width: 100px;
            text-align: center;
            font-feature-settings: "tnum";
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            background: var(--tg-progress-bg);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
            transition: width 0.3s ease;
            overflow: hidden;
        }

        .volume-level {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: var(--tg-progress-filled);
            border-radius: 2px;
            width: 100%;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .volume-container:hover .volume-slider {
            width: 80px;
        }

        .big-play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 122, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            color: white;
            font-size: 2em;
            cursor: pointer;
            transition: all var(--transition-speed);
            z-index: 15;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .big-play-button:hover {
            background: var(--tg-accent-blue);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .big-play-button:active {
            transform: translate(-50%, -50%) scale(0.95);
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 10;
            border-radius: 12px;
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--tg-accent-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stream-info {
            background: var(--tg-card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid var(--tg-card-border);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 0.9em;
            color: var(--tg-text-secondary);
            margin-bottom: 5px;
        }

        .info-value {
            font-weight: 500;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .status-live {
            background: rgba(255, 59, 48, 0.1);
            color: var(--tg-accent-red);
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: var(--tg-text-secondary);
            background: var(--tg-header-bg);
            margin-top: auto;
        }

        .quality-selector {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 25;
            opacity: 0;
            transition: opacity var(--transition-speed);
        }

        .player-wrapper:hover .quality-selector {
            opacity: 1;
        }

        .quality-btn {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 6px 12px;
            color: white;
            font-size: 0.8em;
            cursor: pointer;
            transition: all var(--transition-speed);
            backdrop-filter: blur(10px);
        }

        .quality-btn:hover {
            background: var(--tg-accent-blue);
            border-color: var(--tg-accent-blue);
        }

        /* Мобильные стили */
        @media (max-width: 768px) {
            .page-title {
                font-size: 2em;
            }
            .main-content {
                padding: 20px 15px;
            }
            .custom-controls {
                padding: 15px 10px 8px;
                opacity: 1 !important;
            }
            .time-display {
                min-width: 80px;
                font-size: 0.8em;
            }
            .volume-slider {
                width: 60px;
            }
            .big-play-button {
                width: 60px;
                height: 60px;
                font-size: 1.5em;
            }
            
            .control-btn {
                min-width: 44px;
                min-height: 44px;
            }
            
            @media (max-width: 480px) {
                .volume-slider {
                    display: none;
                }
            }
        }

        .solution-selector {
            background: var(--tg-card-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--tg-card-border);
        }

        .solution-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .solution-btn {
            padding: 8px 16px;
            background: var(--tg-accent-blue);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all var(--transition-speed);
        }

        .solution-btn:hover {
            background: var(--tg-accent-blue-hover);
        }

        .solution-btn.active {
            background: var(--tg-accent-red);
        }

        .info-message {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <i class="fab fa-telegram"></i>
            FS Aesthet
        </div>
    </div>

    <main class="main-content">
        <h1 class="page-title">
            Прямая трансляция
            <div class="live-badge">
                <i class="fas fa-circle"></i>
                LIVE
            </div>
        </h1>
        <div class="page-subtitle">Первый канал - Прямой эфир</div>

        <div class="info-message">
            <i class="fas fa-info-circle"></i> 
            <strong>Внимание:</strong> Прямое подключение к потоку заблокировано CORS политикой. 
            Попробуйте разные методы подключения ниже.
        </div>

        <div class="solution-selector">
            <div style="font-weight: 500; margin-bottom: 10px;">
                <i class="fas fa-plug"></i> Метод подключения:
            </div>
            <div class="solution-buttons" id="solutionButtons">
                <!-- Кнопки решений будут добавлены через JavaScript -->
            </div>
        </div>

        <div class="player-container">
            <div class="player-wrapper" id="playerWrapper">
                <button class="mobile-fullscreen-btn" id="mobileFullscreenBtn">
                    <i class="fas fa-expand"></i>
                </button>

                <div id="loadingOverlay" class="loading-overlay">
                    <div class="loading-spinner"></div>
                    <div>Подключение к трансляции...</div>
                </div>
                
                <button class="big-play-button" id="bigPlayButton">
                    <i class="fas fa-play"></i>
                </button>
                
                <video 
                    id="videoPlayer"
                    playsinline
                    poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='450' viewBox='0 0 800 450'%3E%3Crect width='800' height='450' fill='%23007AFF' opacity='0.1'/%3E%3Ccircle cx='400' cy='225' r='40' fill='%23007AFF' opacity='0.3'/%3E%3Cpath d='M380 205 L420 225 L380 245 Z' fill='%23007AFF'/%3E%3Ctext x='400' y='300' text-anchor='middle' font-family='Arial' font-size='18' fill='%23007AFF'%3EFS Aesthet LIVE%3C/text%3E%3C/svg%3E"
                ></video>
                
                <div class="custom-controls">
                    <button class="control-btn" id="playPauseBtn">
                        <i class="fas fa-play"></i>
                    </button>
                    
                    <div class="progress-container">
                        <div class="time-display" id="currentTime">00:00</div>
                        <div class="progress-bar" id="progressBar">
                            <div class="progress-filled" id="progressFilled"></div>
                            <div class="progress-handle" id="progressHandle"></div>
                        </div>
                        <div class="time-display" id="durationTime">00:00</div>
                    </div>
                    
                    <div class="volume-container">
                        <button class="control-btn" id="volumeBtn">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <div class="volume-slider" id="volumeSlider">
                            <div class="volume-level" id="volumeLevel"></div>
                        </div>
                    </div>
                    
                    <button class="control-btn fullscreen-btn" id="fullscreenBtn">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="stream-info">
            <h3><i class="fas fa-info-circle"></i> Информация о трансляции</h3>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Канал</div>
                    <div class="info-value">Первый канал</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Тип вещания</div>
                    <div class="info-value">Прямой эфир</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Статус</div>
                    <div class="info-value">
                        <span class="status-badge status-live">
                            <i class="fas fa-circle"></i>
                            ПРЯМОЙ ЭФИР
                        </span>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-label">Формат</div>
                    <div class="info-value">MPEG-DASH Stream</div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        © 2025 FS Aesthet. Все права защищены.
    </footer>

    <!-- Подключаем библиотеку dash.js для воспроизведения DASH потоков -->
    <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
    
    <script>
        const video = document.getElementById('videoPlayer');
        const playerWrapper = document.getElementById('playerWrapper');
        const bigPlayButton = document.getElementById('bigPlayButton');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const progressBar = document.getElementById('progressBar');
        const progressFilled = document.getElementById('progressFilled');
        const progressHandle = document.getElementById('progressHandle');
        const currentTime = document.getElementById('currentTime');
        const durationTime = document.getElementById('durationTime');
        const volumeBtn = document.getElementById('volumeBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeLevel = document.getElementById('volumeLevel');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const mobileFullscreenBtn = document.getElementById('mobileFullscreenBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const solutionButtons = document.getElementById('solutionButtons');

        let isDragging = false;
        let wasPlaying = false;
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        let player;
        let currentSolutionIndex = 0;

        // Исходный DASH поток
        const DASH_STREAM_URL = 'https://cdn11.1internet.tv/dash-live3/streams/1tv-dvr/1tvdash.mpd?e=1763740789';

        // Альтернативные потоки (если основной не работает)
        const ALTERNATIVE_STREAMS = [
            {
                name: 'Основной поток',
                url: 'https://cdn11.1internet.tv/dash-live3/streams/1tv-dvr/1tvdash.mpd?e=1763740789',
                type: 'dash'
            },
            {
                name: 'Альтернативный источник',
                url: 'https://stream.1tv.ru/live',
                type: 'hls'
            },
            {
                name: 'Резервный поток',
                url: 'https://1tv.live/live',
                type: 'hls'
            }
        ];

        // Методы решения CORS проблемы
        const SOLUTIONS = [
            {
                name: 'Прямое подключение',
                description: 'Попытка прямого подключения (скорее всего не сработает)',
                method: 'direct'
            },
            {
                name: 'No-CORS режим',
                description: 'Попытка загрузки без CORS проверок',
                method: 'nocors'
            },
            {
                name: 'Cloudflare Worker Proxy',
                description: 'Использование Cloudflare Worker как прокси',
                method: 'cloudflare'
            },
            {
                name: 'Local CORS Proxy',
                description: 'Запуск локального прокси сервера',
                method: 'localproxy'
            },
            {
                name: 'Iframe обход',
                description: 'Загрузка через iframe с другого домена',
                method: 'iframe'
            }
        ];

        // Форматирование времени
        function formatTime(seconds) {
            if (isNaN(seconds)) return '00:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Обновление прогресса
        function updateProgress() {
            if (!isDragging && video.duration && !isNaN(video.duration)) {
                const percent = (video.currentTime / video.duration) * 100;
                progressFilled.style.width = percent + '%';
                progressHandle.style.left = percent + '%';
                currentTime.textContent = formatTime(video.currentTime);
            }
        }

        // Перемотка
        function seek(e) {
            const rect = progressBar.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            video.currentTime = percent * video.duration;
        }

        // Управление громкостью
        function setVolume(e) {
            const rect = volumeSlider.getBoundingClientRect();
            let percent = (e.clientX - rect.left) / rect.width;
            percent = Math.max(0, Math.min(1, percent));
            
            video.volume = percent;
            volumeLevel.style.width = (percent * 100) + '%';
            updateVolumeIcon();
        }

        function updateVolumeIcon() {
            const icon = volumeBtn.querySelector('i');
            if (video.volume === 0 || video.muted) {
                icon.className = 'fas fa-volume-mute';
            } else if (video.volume < 0.5) {
                icon.className = 'fas fa-volume-down';
            } else {
                icon.className = 'fas fa-volume-up';
            }
        }

        // Полноэкранный режим
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                if (playerWrapper.requestFullscreen) {
                    playerWrapper.requestFullscreen();
                } else if (playerWrapper.webkitRequestFullscreen) {
                    playerWrapper.webkitRequestFullscreen();
                } else if (playerWrapper.msRequestFullscreen) {
                    playerWrapper.msRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        }

        function updateFullscreenIcon() {
            const isFullscreen = document.fullscreenElement;
            const icon = fullscreenBtn.querySelector('i');
            const mobileIcon = mobileFullscreenBtn.querySelector('i');
            
            if (isFullscreen) {
                icon.className = 'fas fa-compress';
                mobileIcon.className = 'fas fa-compress';
            } else {
                icon.className = 'fas fa-expand';
                mobileIcon.className = 'fas fa-expand';
            }
        }

        // Создание кнопок решений
        function createSolutionButtons() {
            SOLUTIONS.forEach((solution, index) => {
                const button = document.createElement('button');
                button.className = 'solution-btn';
                button.textContent = solution.name;
                button.title = solution.description;
                button.onclick = () => switchSolution(index);
                solutionButtons.appendChild(button);
            });
        }

        // Переключение решения
        function switchSolution(index) {
            currentSolutionIndex = index;
            
            // Обновляем активную кнопку
            const buttons = solutionButtons.querySelectorAll('.solution-btn');
            buttons.forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
            
            // Перезапускаем плеер
            initPlayer();
        }

        // Получение URL потока в зависимости от выбранного метода
        function getStreamUrl() {
            const solution = SOLUTIONS[currentSolutionIndex];
            const stream = ALTERNATIVE_STREAMS[0]; // Используем основной поток
            
            switch(solution.method) {
                case 'direct':
                    return stream.url;
                    
                case 'nocors':
                    // Попытка использовать fetch с no-cors (ограниченно)
                    return stream.url;
                    
                case 'cloudflare':
                    // Простой Cloudflare Worker прокси (нужно развернуть свой)
                    return `https://cors-proxy.avlog.workers.dev/?url=${encodeURIComponent(stream.url)}`;
                    
                case 'localproxy':
                    // Локальный прокси (для разработки)
                    return `http://localhost:8080/${encodeURIComponent(stream.url)}`;
                    
                case 'iframe':
                    // Альтернатива: открыть в новом окне/iframe
                    return stream.url;
                    
                default:
                    return stream.url;
            }
        }

        // Инициализация плеера
        function initPlayer() {
            // Останавливаем текущий плеер
            if (player) {
                player.reset();
                player = null;
            }

            const solution = SOLUTIONS[currentSolutionIndex];
            loadingOverlay.style.display = 'flex';
            loadingOverlay.innerHTML = `
                <div style="text-align: center;">
                    <div class="loading-spinner"></div>
                    <div>Попытка подключения: ${solution.name}</div>
                    <div style="margin-top: 10px; font-size: 0.8em; opacity: 0.8;">
                        ${solution.description}
                    </div>
                </div>
            `;

            const streamUrl = getStreamUrl();
            console.log('Попытка подключения к:', streamUrl);

            if (solution.method === 'iframe') {
                // Для iframe метода показываем инструкцию
                loadingOverlay.innerHTML = `
                    <div style="text-align: center;">
                        <i class="fas fa-external-link-alt" style="font-size: 3em; margin-bottom: 15px; color: var(--tg-accent-blue);"></i>
                        <div>Метод: ${solution.name}</div>
                        <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                            ${solution.description}
                        </div>
                        <div style="margin-top: 20px;">
                            <button onclick="window.open('https://1tv.ru/live', '_blank')" style="padding: 12px 24px; background: var(--tg-accent-blue); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em;">
                                <i class="fas fa-external-link-alt"></i> Открыть на 1tv.ru
                            </button>
                        </div>
                        <div style="margin-top: 15px; font-size: 0.8em;">
                            Или попробуйте другой метод подключения
                        </div>
                    </div>
                `;
                return;
            }

            if (dashjs.supportsMediaSource()) {
                console.log('Используется dash.js для воспроизведения DASH потока');
                
                player = dashjs.MediaPlayer().create();
                player.initialize(video, streamUrl, true);
                
                // Минимальные настройки чтобы избежать ошибок
                player.updateSettings({
                    'streaming': {
                        'lowLatencyEnabled': false
                    }
                });
                
                // События dash.js
                player.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED, function() {
                    console.log('DASH поток инициализирован через', solution.name);
                    loadingOverlay.style.display = 'none';
                    bigPlayButton.style.display = 'flex';
                });
                
                player.on(dashjs.MediaPlayer.events.MANIFEST_LOADED, function() {
                    console.log('Манифест загружен');
                });
                
                player.on(dashjs.MediaPlayer.events.ERROR, function(e) {
                    console.error('Ошибка DASH плеера через', solution.name, e);
                    handleStreamError(`Метод "${solution.name}" не сработал. Попробуйте другой способ.`);
                });
                
            } else {
                console.error('Браузер не поддерживает MediaSource');
                handleStreamError('Браузер не поддерживает формат DASH');
            }

            video.volume = 1;
            volumeLevel.style.width = '100%';
            updateVolumeIcon();
        }

        function handleStreamError(errorMessage) {
            console.error('Stream error:', errorMessage);
            loadingOverlay.innerHTML = `
                <div style="text-align: center;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 15px; color: var(--tg-accent-red);"></i>
                    <div>Ошибка подключения</div>
                    <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                        ${errorMessage}
                    </div>
                    <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="initPlayer()" style="padding: 8px 16px; background: var(--tg-accent-blue); color: white; border: none; border-radius: 6px; cursor: pointer;">
                            Повторить
                        </button>
                        <button onclick="switchSolution((currentSolutionIndex + 1) % SOLUTIONS.length)" style="padding: 8px 16px; background: var(--tg-accent-blue); color: white; border: none; border-radius: 6px; cursor: pointer;">
                            Следующий метод
                        </button>
                        <button onclick="window.open('https://1tv.ru/live', '_blank')" style="padding: 8px 16px; background: var(--tg-accent-red); color: white; border: none; border-radius: 6px; cursor: pointer;">
                            На 1tv.ru
                        </button>
                    </div>
                </div>
            `;
        }

        // События управления видео
        bigPlayButton.addEventListener('click', () => {
            video.play().catch(e => {
                console.error('Ошибка воспроизведения:', e);
                handleStreamError('Ошибка воспроизведения видео');
            });
            bigPlayButton.style.display = 'none';
            playerWrapper.classList.add('controls-visible');
        });

        playerWrapper.addEventListener('dblclick', () => {
            if (isMobile) {
                toggleFullscreen();
            }
        });

        playPauseBtn.addEventListener('click', () => {
            if (video.paused) {
                video.play();
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                video.pause();
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        });

        video.addEventListener('play', () => {
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            bigPlayButton.style.display = 'none';
        });

        video.addEventListener('pause', () => {
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            if (video.currentTime === 0) {
                bigPlayButton.style.display = 'flex';
            }
        });

        video.addEventListener('timeupdate', updateProgress);
        video.addEventListener('loadedmetadata', () => {
            if (!isNaN(video.duration)) {
                durationTime.textContent = formatTime(video.duration);
            }
        });

        video.addEventListener('canplay', () => {
            loadingOverlay.style.display = 'none';
        });

        video.addEventListener('waiting', () => {
            loadingOverlay.style.display = 'flex';
        });

        video.addEventListener('playing', () => {
            loadingOverlay.style.display = 'none';
        });

        video.addEventListener('error', (e) => {
            console.error('Ошибка видео:', e);
            handleStreamError('Ошибка видео элемента');
        });

        // Прогресс бар
        progressBar.addEventListener('click', seek);
        progressBar.addEventListener('mousedown', (e) => {
            isDragging = true;
            wasPlaying = !video.paused;
            video.pause();
            seek(e);
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                seek(e);
            }
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                if (wasPlaying) {
                    video.play();
                }
            }
        });

        // Громкость
        volumeSlider.addEventListener('click', setVolume);
        volumeBtn.addEventListener('click', () => {
            video.muted = !video.muted;
            updateVolumeIcon();
        });

        // Полноэкранный режим
        fullscreenBtn.addEventListener('click', toggleFullscreen);
        mobileFullscreenBtn.addEventListener('click', toggleFullscreen);

        document.addEventListener('fullscreenchange', updateFullscreenIcon);
        document.addEventListener('webkitfullscreenchange', updateFullscreenIcon);
        document.addEventListener('msfullscreenchange', updateFullscreenIcon);

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            createSolutionButtons();
            // Начинаем с первого метода
            switchSolution(0);
        });
    </script>
</body>
</html>